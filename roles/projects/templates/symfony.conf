{% if item.provider=='symfony' %}
# redirect http to https
server {
	server_name          {{ item.host }};
	listen               *:80;
	listen               [::]:80;

	return 301 https://{{ item.host }}$request_uri;
}

server {
        listen 443 ssl;
        ssl on;
        ssl_certificate     /etc/ssl/crt/{{ item.host }}.crt;
        ssl_certificate_key /etc/ssl/crt/{{ item.host }}.pem;
        ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers         HIGH:!aNULL:!MD5;
        server_name         {{ item.host }};
        root                {{ projects_web_path }}/{{ item.host }}/web;

        location / {
            try_files $uri /app.php$is_args$args;
        }

        location ~ ^/(app_dev|config)\.php(/|$) {
            fastcgi_pass            unix:/run/php/php7.1-fpm.sock;
            fastcgi_split_path_info ^(.+\.php)(/.*)$;
            include                 fastcgi_params;
            fastcgi_param           SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
            fastcgi_param           DOCUMENT_ROOT $realpath_root;
        }

        location ~ ^/app\.php(/|$) {
            fastcgi_pass            unix:/run/php/php7.1-fpm.sock;
            fastcgi_split_path_info ^(.+\.php)(/.*)$;
            include                 fastcgi_params;
            fastcgi_param           SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
            fastcgi_param           DOCUMENT_ROOT $realpath_root;
            internal;
        }

        location ~ \.php$ {
            return 404;
        }

        error_log /var/log/nginx/{{ item.name }}_error.log;
        access_log /var/log/nginx/{{ item.name }}_access.log;
}
{% elif item.provider=='laravel' %}
# redirect http to https
server {
	server_name          {{ item.host }};
	listen               *:80;
	listen               [::]:80;

	return 301 https://{{ item.host }}$request_uri;
}

server {
        listen 443 ssl;
        ssl on;
        ssl_certificate     /etc/ssl/crt/{{ item.host }}.crt;
        ssl_certificate_key /etc/ssl/crt/{{ item.host }}.pem;
        ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers         HIGH:!aNULL:!MD5;
        server_name         {{ item.host }};
        root                {{ projects_web_path }}/{{ item.host }}/public;

        location / {
                try_files $uri /index.php$is_args$args;
        }

        location ~ ^/index\.php(/|$) {
                fastcgi_pass            unix:/run/php/php7.1-fpm.sock;
                fastcgi_split_path_info ^(.+\.php)(/.*)$;
                include                 fastcgi_params;
                fastcgi_param           SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
                fastcgi_param            DOCUMENT_ROOT $realpath_root;
                internal;
        }

        location ~ \.php$ {
                return 404;
        }

        error_log /var/log/nginx/{{ item.name }}_error.log;
        access_log /var/log/nginx/{{ item.name }}_access.log;
}

{% endif %}